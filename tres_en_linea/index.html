<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ta Te Ti</title>
    <style>
        #tablero{
            height: 248px;
            width: 248px;
            margin: 30px auto;
        }

        .celda{
            /* display: none; */
            float: left;
            background: #fff;
            height: 80px;
            width: 80px;
            border: solid 1px gray;
            font-size: 20pt;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Console Log for Ticky Tacky Toe Goodness</h1>
    <img src="ttt_states.jpg" width="100%" />
    <section id="tablero">
        <div class="celda" id="0" onclick="putLetterOn(0, 'x', -1)"></div>
        <div class="celda" id="1" onclick="putLetterOn(1, 'x', -1)"></div>
        <div class="celda" id="2" onclick="putLetterOn(2, 'x', -1)"></div>
        <div class="celda" id="3" onclick="putLetterOn(3, 'x', -1)"></div>
        <div class="celda" id="4" onclick="putLetterOn(4, 'x', -1)"></div>
        <div class="celda" id="5" onclick="putLetterOn(5, 'x', -1)"></div>
        <div class="celda" id="6" onclick="putLetterOn(6, 'x', -1)"></div>
        <div class="celda" id="7" onclick="putLetterOn(7, 'x', -1)"></div>
        <div class="celda" id="8" onclick="putLetterOn(8, 'x', -1)"></div>
        <button onclick="clearBoard()">Limpiar</button>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.0.0/dist/tf.min.js"></script>
    <script>
        // tf.ready().then(() => {
        //     const modelPath = 'model/ttt_model.json'
        //     tf.tidy(() => {
        //     tf.loadLayersModel(modelPath).then((model) => {
        //         // Three board states
        //         const emptyBoard = tf.zeros([9])
        //         const betterBlockMe = tf.tensor([-1, 0, 0, 1, 1, -1, 0, 0, -1])
        //         const goForTheKill = tf.tensor([1, 0, 1, 0, -1, -1, -1, 0, 1])
        //         // const testBoard = tf.tensor([1, 0, 0, 0, 0, 0, 0 ,0 ,-1])

        //         // Stack states into a shape [3, 9]
        //         const matches = tf.stack([emptyBoard, betterBlockMe, goForTheKill])

        //         const result = model.predict(matches)
        //         // Log the results
        //         result.reshape([3, 3, 3]).print()
        //         // result.print()
        //     })
        //     })
        // })
        
        let board = [0, 0, 0, 0, 0, 0, 0, 0, 0]

        //board functions
        const putLetterOn = (index, letter, value) =>{
            if(board[index] === 0){
                const cell = document.getElementById(`${index}`)
                cell.innerHTML = letter
                board[index] = value
                // console.log(board)
            }
            if(value === -1) getBestMove(board)
        }
        
        const clearBoard = () =>{
            for (let index = 0; index < 9; index++) {
                const cell = document.getElementById(`${index}`);
                cell.innerHTML = ""
                board[index] = 0
            }
            // console.log(board)
        }

        //move functions

        const getBestMove = (board) =>{
            tf.ready().then(() => {                
                const modelPath = "model/ttt_model.json"

                tf.tidy(()=>{
                    tf.loadLayersModel(modelPath).then(model => {
                        const tensorBoard = tf.tensor(board)

                        const matches = tf.stack([tensorBoard])

                        const result = model.predict(matches)

                        result.reshape([1, 3, 3]).print()
                        
                        const predictBoard = result.arraySync()

                        let bestValue = 0
                        let bestIndex = 0

                        predictBoard[0].forEach((value, index) => {
                            if(value > bestValue && board[index] === 0){
                                bestValue = value
                                bestIndex = index
                            }
                        })

                        console.log("value: ", bestValue, "; index: ", bestIndex)
                        
                        putLetterOn(bestIndex, "O", 1)
                    })
                })
            })
        } 
    </script>
  </body>
</html>